#!/bin/bash

echo "üîß Building Cortex App for Production Testing"
echo "=============================================="

# Kill any existing Cortex processes
echo "üîÑ Stopping any running Cortex processes..."
killall Cortex 2>/dev/null || true

# Build the app
echo "üî® Building Cortex app..."
xcodebuild -project Cortex.xcodeproj -scheme Cortex -configuration Release build

if [ $? -eq 0 ]; then
    echo "‚úÖ Build successful!"
    
    # Find the built app
    APP_PATH=$(find ~/Library/Developer/Xcode/DerivedData -name "Cortex.app" -type d | head -1)
    
    if [ -n "$APP_PATH" ]; then
        echo "üì± Found app at: $APP_PATH"
        
        # Copy to Desktop for easy access
        DESKTOP_PATH="$HOME/Desktop/Cortex.app"
        echo "üìã Copying to Desktop..."
        rm -rf "$DESKTOP_PATH" 2>/dev/null || true
        cp -R "$APP_PATH" "$DESKTOP_PATH"
        
        echo ""
        echo "üéâ Build Complete!"
        echo "=================="
        echo "üì± App location: $DESKTOP_PATH"
        echo ""
        echo "üîß Next Steps:"
        echo "1. Double-click Cortex.app on Desktop to launch"
        echo "2. When prompted, grant Accessibility permissions"
        echo "3. Test memory insertion in any text field"
        echo ""
        echo "üîí If permissions don't work:"
        echo "   - Go to System Settings > Privacy & Security > Accessibility"
        echo "   - Remove Cortex if listed"
        echo "   - Click '+' and manually add Cortex.app from Desktop"
        echo ""
        
        # Open the app
        echo "üöÄ Launching Cortex..."
        open "$DESKTOP_PATH"
        
    else
        echo "‚ùå Could not find built app"
        exit 1
    fi
else
    echo "‚ùå Build failed!"
    exit 1
fi 